"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(){if("live.bilibili.com"===location.hostname&&"/"!==location.pathname){var a;if(!store.enabled)return;store["delete"]=function(a,b){if(void 0!==a){var c=store.get(a);void 0!==c&&(void 0!==b&&null!==b?"string"!=typeof b&&"number"!=typeof b||(c[b]&&delete c[b],store.set(a,c)):store.remove(a))}};var b={scriptOptions:{},hasInit:!1,giftList:{},protocol:location.protocol};b.addScriptByFile=function(a,b){var c=document.createElement("script");c.id="bilibiliHelperScript",c.src=chrome.extension.getURL(a),"object"===("undefined"==typeof b?"undefined":_typeof(b))&&c.setAttribute("options",JSON.stringify(b)),document.body.appendChild(c)},b.addScriptByText=function(a){var b=document.createElement("script");b.innerHTML=a,document.body.appendChild(b)},b.getDateDiff=function(a,b){var c=new Date(Date.parse(a.replace(/-/g,"/"))).getTime(),d=new Date(Date.parse(b.replace(/-/g,"/"))).getTime(),e=Math.abs(c-d)/864e5;return e},b.getRoomHTML=function(a){return $.get("//live.bilibili.com/"+a).promise()},b.getRoomIdByUrl=function(){return parseInt(/^\/([\d]+)/.exec(location.pathname)[1],10)},b.getUser=function(){return $.getJSON("//live.bilibili.com/user/getuserinfo").promise()},b.eval=function(a){var b=Function;return new b("return "+a)()},b.scrollEvent=_.throttle(function(a){var b=$(a.currentTarget),c=b.scrollTop(),d=b.scrollLeft(),e=b[0].scrollWidth,f=b[0].scrollHeight,g=b.innerWidth(),h=b.innerHeight(),i="DOMMouseScroll"==a.type?a.originalEvent.detail*-40:a.originalEvent.wheelDeltaY,j="DOMMouseScroll"==a.type?a.originalEvent.detail*-40:a.originalEvent.wheelDeltaX,k=function(){return a.stopPropagation(),a.preventDefault(),a.returnValue=!1,!1},l=Math.abs(j),m=Math.abs(i);if(m>l){if(i<=0&&-i>f-h-c)return b.scrollTop(f),k();if(i>0&&i>c)return b.scrollTop(0),k()}else if(m<l){if(j>0&&j>d)return b.scrollLeft(0),k();if(j<0&&-j>e-g-d)return b.scrollLeft(e),k()}},60),b.each=function(a,b){if(b)if(a instanceof Array)for(var c=0,d=a.length;c<d&&b.call(a[c],c)!==!1;c++);else if("object"===("undefined"==typeof a?"undefined":_typeof(a))){var e=null;for(e in a)if(b.call(a[e],e)===!1)break}},b.getCookie=function(a){var b=void 0,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null},b.setCookie=function(a,b,c){c=c||0;var d="";if(0!=c){var e=new Date;e.setTime(e.getTime()+1e3*c),d="; expires="+e.toGMTString()}document.cookie=a+"="+escape(b)+d+"; path=/"},b.OCR={getGrayscaleMap:function(a){function b(b,c){var d=a.getImageData(b,c,1,1).data;return d?77*d[0]+150*d[1]+29*d[2]+128>>8:0}for(var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:235,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,f=[],g=0;g<e;g++)for(var h=0;h<d;h++){var i=b(h,g);f.push(i>c?i:0)}return f},orderFilter2In3x3:function(a){for(var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,d=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,function(b,d){return b+d*c>=0?a[b+d*c]:255}),e=[],f=a.length,g=b-1,h=0;h<f;++h){var i=[h%c,Math.floor(h/c)],j=i[0],k=i[1],l=new Array(9);l[0]=d(j-1,k-1),l[1]=d(j+0,k-1),l[2]=d(j+1,k-1),l[3]=d(j-1,k+0),l[4]=d(j+0,k+0),l[5]=d(j+1,k+0),l[6]=d(j-1,k+1),l[7]=d(j+0,k+1),l[8]=d(j+1,k+1),l.sort(function(a,b){return a-b}),e.push(l[g])}return e},execMap:function(a){for(var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,c=[],d=a.length,e=0;e<d;++e){var f=0,g=[e%120,Math.round(e/120)],h=(g[0],g[1],a[e-120]),i=a[e-120-1],j=a[e-120+1],k=a[e-1],l=a[e+1],m=a[e+120],n=a[e+120-1],o=a[e+120+1];h&&(f+=1),i&&(f+=1),j&&(f+=1),k&&(f+=1),l&&(f+=1),m&&(f+=1),n&&(f+=1),o&&(f+=1),f>b?c.push(1):c.push(0)}return c}},b.liveQuickLogin=function(){function a(){throw window.biliQuickLogin?(window.biliQuickLogin(function(){window.location.reload()}),"Bilibili Live: 您没登陆，想干撒子？~~ -_-"):"Bilibili Live: 快速登录脚本未正确载入."}if(!b.getCookie("DedeUserID")&&!b.getCookie("LIVE_LOGIN_DATA"))try{window.biliQuickLogin?a():$.getScript("https://static-s.bilibili.com/account/bili_quick_login.js",function(b,c){"success"===c&&a()})}catch(c){throw new Error(c)}},b.getRoomId=function(){return store.get("bilibili_helper_live_roomId")[b.getRoomIdByUrl()]},b.getRoomInfo=function(){return $.getJSON("//api.live.bilibili.com/room/v1/Room/room_init?id="+b.roomId).promise()},b.getAnchorInRoom=function(){return $.getJSON("//api.live.bilibili.com/live_user/v1/UserInfo/get_anchor_in_room?roomid="+b.roomId).promise()},b.getUserInfoInRoom=function(){return $.getJSON("//api.live.bilibili.com/live_user/v1/UserInfo/get_info_in_room?roomid="+b.roomId).promise()},b.numFormat=function(a){var b=a;return a>=1e4&&(b=(a/1e4).toFixed(1)+"万"),b},b.rgb2hex=function(a){function b(a,b){for(var c=a.toString(16);c.length<b;)c="0"+c;return c}if("#"===a.charAt(0))return a;var c=a.split(/\D+/),d=65536*Number(c[1])+256*Number(c[2])+Number(c[3]);return"#"+b(d,6)},b.getDomType=function(a){var b=Object.prototype.toString.call(a),c=/HTML.*.Element/;return"[object Object]"===b&&a.jquery?"jQuery Object":"[object Object]"===b?"Object":"[object Number]"===b?"Number":"[object String]"===b?"String":"[object Array]"===b?"Array":"[object Boolean]"===b?"Boolean":"[object Function]"===b?"Function":"[object Null]"===b?"null":"[object Undefined]"===b?"undefined":b.match(c)?"HTML Element":"[object HTMLCollection]"===b?"HTML Elements Collection":null},b.randomEmoji={list:{happy:["(｀･ω･´)","=‿=✧","●ω●","(/ ▽ \\)","(=・ω・=)","(●'◡'●)ﾉ♥","<(▰˘◡˘▰)>","(⁄ ⁄•⁄ω⁄•⁄ ⁄)","(ง,,• ᴗ •,,)ง ✧"],shock:[",,Ծ‸Ծ,,","(｀･д･´)","Σ( ° △ °|||)︴","┌( ಠ_ಠ)┘","(ﾟДﾟ≡ﾟдﾟ)!?"],sad:["∑(っ °Д °;)っ","＞︿＜","＞△＜","●︿●","(´；ω；`)"],helpless:["◐▽◑","ʅ（´◔౪◔）ʃ","_(:3 」∠)_","_(┐「ε:)_","(/・ω・＼)","(°▽°)ﾉ"]},happy:function(){return b.randomEmoji.list.happy[Math.floor(Math.random()*b.randomEmoji.list.happy.length)]},sad:function(){return b.randomEmoji.list.sad[Math.floor(Math.random()*b.randomEmoji.list.sad.length)]},shock:function(){return b.randomEmoji.list.shock[Math.floor(Math.random()*b.randomEmoji.list.shock.length)]},helpless:function(){return b.randomEmoji.list.helpless[Math.floor(Math.random()*b.randomEmoji.list.helpless.length)]}},b.countdown=function c(a){var d=this;_classCallCheck(this,c);var e=new Date,f=a.endTime;if(!f||!(f instanceof Date)||f.getTime()<=e.getTime())return void console.error("倒计时时间设置错误");var g=setInterval(function(){var c=f.getTime()-e.getTime(),d=Math.floor(c/60/1e3),h=c-60*d*1e3,i=Math.floor(h/1e3);d=d<10?"0"+d:d,i=i<10?"0"+i:i;var j=d+":"+i;return"jQuery Object"===b.getDomType(a.element)?a.element.html(j):a.element.innerHTML=j,"00"===d&&"00"===i?(clearInterval(g),void(a.callback&&a.callback())):void f.setSeconds(f.getSeconds()-1)},1e3);this.countDown=g,this.clearCountdown=function(){clearInterval(d.countDown)}},b.console={option:{display:{danmu:!1,tv_end:!1,gift:!1,system:!1,tv:!1,sys_gift:!0}},watcher:function(a){console.warn("%c监控:"+a,"color:#FFFFFF;background-color:#4fc1e9;padding:5px;border-radius:7px;line-height:30px;")},info:function(a,c){if("danmu"===a&&b.console.option.display.danmu){var d=c.info[1],e=c.info[2][0],f=c.info[2][1],g=c.info[4][0],h=c.info[4][1];console.warn("%c(UL:"+g+")"+e+"-"+f+":"+d+" 排名:"+h,"color:#FFFFFF;background-color:#646c7a;padding:5px;border-radius:7px;line-height:30px;")}else if("system"===a&&b.console.option.display.system){var i=c.msg,j=c.url;console.warn("%c系统通告:"+i+" 地址:"+j,"color:#FFFFFF;background-color:#e74e8f;padding:5px;border-radius:7px;line-height:30px;")}else if("tv_end"===a&&b.console.option.display.tv_end);else if("gift"===a&&b.console.option.display.gift){var k=c.data.giftName,l=c.data.num,m=c.data.uname;console.warn("%c喂食:"+k+" x"+l+" 用户名:"+m,"color:#FFFFFF;background-color:#ff8e29;padding:5px;border-radius:7px;line-height:30px;")}else"sys_gift"===a&&b.console.option.display.sys_gift&&console.warn("%c系统通告:"+c.tips+" 地址:"+c.url,"color:#FFFFFF;background-color:#e74e8f;padding:5px;border-radius:7px;line-height:30px;")}},b.createPanel=function(a,b,c,d,e,f){var g=void 0,h=void 0;switch(c){case"click":g=c,h=c;break;case"mouseenter":case"hover":case"mouseover":g="mouseenter",h="mouseleave"}var i=$("<div />").addClass("live-hover-panel arrow-top "+d).attr("id",e);return a.append(b,i),b.off(g).on(g,function(a){function b(a){a.stopPropagation();var c=a&&(a.target||a.srcElement);$(c).hasClass(d)||$(c).parents("."+d).length||(i.addClass("out"),setTimeout(function(){$(window).off(g,b),i.removeClass("out").removeClass("show").css("display","")},300))}return a.stopPropagation(),$(window).click(),i.hasClass("show")?void("function"==typeof $(window)[h]&&$(window)[h]()):(i.addClass("show"),setTimeout(function(){$(window).off(h).on(h,b)},1),void("function"==typeof f&&f()))}),i},b.liveToast=function d(a,b,c,d){"boolean"==typeof c&&(c="info");var e=document.createDocumentFragment(),f=document.createElement("div");if("success"!==(c=c||"info")&&"caution"!==c&&"error"!==c&&"info"!==c)throw new Error(i+" 在使用 Link Toast 时必须指定正确的类型: success || caution || error || info");if(f.innerHTML='<span class="toast-text">'+b+"</span>",f.className="link-toast "+c+" "+(d?"fixed":""),!a.className&&!a.attributes)throw new Error(i+" 传入 element 不是有效节点.");var g=a.getBoundingClientRect(),h=g.left,j=g.top,k=g.width,l=g.height,m=document.documentElement&&document.documentElement.scrollLeft||document.body.scrollLeft;f.style.left=h+k+m+"px";var n=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;f.style.top=j+l+n+"px",setTimeout(function(){f.className+=" out",setTimeout(function(){f.parentNode.removeChild(f)},350)},4e3),e.appendChild(f),document.body.appendChild(e);var o=document.body.offsetWidth,p=f.getBoundingClientRect().left,q=f.offsetWidth;o-q-p<0&&(f.style.left=o-q-10+m+"px")},b.doSign={getSignInfo:function(){return $.getJSON("//live.bilibili.com/sign/GetSignInfo").promise()},init:function(){chrome.runtime.sendMessage({command:"getOption",key:"doSign"},function(a){if("on"===a.value){var c=store.get("bilibili_helper_userInfo").username,d=void 0;(d={})[c]={today:!1,date:void 0},store.set("bilibili_helper_doSign",d),b.doSign.getSignInfo().done(function(a){if(0===a.code&&0===a.data.status)b.doSign.sign(),setInterval(b.doSign.sign,6e4);else if(0===a.code&&1===a.data.status){var c=store.get("bilibili_helper_userInfo").username,d=void 0;(d=store.get("bilibili_helper_doSign"))[c]={today:!0,date:(new Date).getDate()},store.set("bilibili_helper_doSign",d)}})}})},sign:function(){var a=(new Date).getDate(),c=store.get("bilibili_helper_userInfo").username;if(!store.get("bilibili_helper_doSign")[c].today||store.get("bilibili_helper_doSign")[c].date!=a){$(".calendar-checkin .checkin-btn").click();var d=setTimeout(function(){b.doSign.getSignInfo().done(function(b){if("ok"==b.msg&&(b.msg="签到成功"),0===b.code&&0!==b.data.status){var e;(e=store.get("bilibili_helper_doSign"))[c]={today:!0,date:a},store.set("bilibili_helper_doSign",e),clearTimeout(d);var f=new Notification(b.msg,{body:b.data.text,icon:"//static.hdslb.com/live-static/images/7.png"});setTimeout(function(){f.close()},1e4)}})},2e3)}}},b.currentRoom=[],b.treasure={imgInit:!1,timer:0,stop:!1,silverSum:0,correctStr:{g:9,z:2,Z:2,o:0,l:1,B:8,O:0,S:6,s:6,i:1,I:1,".":"-",_:4,b:6,R:8,"|":1,D:0},silverSeed:!1,allowCtrl:!1,status:"waiting",finished:!1,boxHidden:!1,panelHidden:!0,panelOut:!1,page:1,countdown:null,taskInfo:{startTime:"",endTime:"",minute:"",award:""},captcha:{src:"",userInput:"",question:"",answer:"",refresh:function(){b.treasure.getCaptcha(function(a){b.treasure.captcha.src=a,b.treasure.captchaBoxImg.attr("src",a)}),b.treasure.captchaBoxInput.val("")}},awardBtn:{text:"领取",bk:"",interval:null,awarding:function(){b.treasure.awardBtn.bk=b.treasure.awardBtn.text,b.treasure.awardBtn.text="领取中.";var a=b.treasure.treasureCtrl.find(".acquiring-panel .get-award-btn");a.text(b.treasure.awardBtn.text),b.treasure.awardBtn.interval=setInterval(function(){return b.treasure.awardBtn.text.indexOf("...")>-1?(b.treasure.awardBtn.text="领取中",void a.text(b.treasure.awardBtn.text)):(b.treasure.awardBtn.text+=".",void a.text(b.treasure.awardBtn.text))},500)},restore:function(){clearInterval(b.treasure.awardBtn.interval),b.treasure.awardBtn.text=b.treasure.awardBtn.bk}},waitingEmoji:b.randomEmoji.happy(),panelEmoji:b.randomEmoji.helpless(),init:function(){chrome.runtime.sendMessage({command:"getOption",key:"autoTreasure"},function(a){"on"===a.value&&setTimeout(function(){if(b.scriptOptions.treasure=!0,b.treasure.silverSum=store.get("bilibili_helper_treasure_silver_count"),b.treasure.originCtrl=$("#gift-control-vm .treasure-box"),b.treasure.treasureCtrl=b.treasure.originCtrl.clone(),b.treasure.originCtrl.hide(),b.treasure.treasureCtrl.attr("id","helperTreasurePlanel"),$("#gift-control-vm .treasure-box").attr("id","originTreasurePlanel").after(b.treasure.treasureCtrl),b.treasure.statusText=b.treasure.treasureCtrl.find(".status-text"),b.treasure.infoSection=b.treasure.treasureCtrl.find(".info-section"),b.treasure.boxSide=b.treasure.treasureCtrl.find(".box-slide"),b.treasure.captchaBox=$("<div/>").addClass("captcha-widget").hide(),b.treasure.captchaBoxTitle=$("<div>宝箱时间到，输入验证码领取奖励 ●ω●</div>").addClass("status-text t-no-wrap"),b.treasure.captchaBoxForm=$("<form/>").addClass("treasure-box-captcha-form"),b.treasure.captchaBoxInputCtl=$("<div/>").addClass("input-ctnr"),b.treasure.captchaBoxInput=$("<input/>").addClass("link-input dp-i-block v-middle"),b.treasure.captchaBoxImg=$("<img/>").addClass("captcha-img dp-i-block v-middle").attr("src",""),b.treasure.captchaBoxRefreshButton=$("<button/>").addClass("refresh-captcha dp-i-block v-middle pointer").append('<i class="icon icon-font icon-replace"></i>'),b.treasure.captchaBoxSubmitButtonBox=$("<div/>").addClass("submit-btn"),b.treasure.captchaBoxSubmitButton=$("<button/>").addClass("bl-button bl-button--primary bl-button--size").append('<span data-v-d19d45c0="" class="txt">领取</span>'),b.treasure.captchaBoxInputCtl.append(b.treasure.captchaBoxInput,b.treasure.captchaBoxImg,b.treasure.captchaBoxRefreshButton),b.treasure.getCaptcha(function(a){b.treasure.captchaBoxImg.attr("src",a)}),b.treasure.captchaBoxSubmitButtonBox.append(b.treasure.captchaBoxSubmitButton),b.treasure.captchaBoxForm.append(b.treasure.captchaBoxInputCtl,b.treasure.captchaBoxSubmitButtonBox).attr("name","treasure-box-captcha-form"),b.treasure.captchaBox.append(b.treasure.captchaBoxTitle,b.treasure.captchaBoxForm),b.treasure.statusText.after(b.treasure.captchaBox),b.treasure.canvas=document.createElement("canvas"),b.treasure.canvas.width=120,b.treasure.canvas.height=40,document.body.appendChild(b.treasure.canvas),b.treasure.context=b.treasure.canvas.getContext("2d"),b.treasure.context.font="40px agencyfbbold",b.treasure.context.textBaseline="top",!window.OCRAD){var a=document.createElement("script");a.src=chrome.extension.getURL("ocrad.min.js"),document.body.appendChild(a)}b.treasure.infoSection.find(".slide-btn.right").show().on("click",function(){b.treasure.page<b.treasure.taskInfo.max_times&&(b.treasure.page+=1,b.treasure.setInfoSectionPage(b.treasure.page,b.treasure.taskInfo.max_times))}),b.treasure.infoSection.find(".slide-btn.left").show().on("click",function(){b.treasure.page>1&&(b.treasure.page-=1,b.treasure.setInfoSectionPage(b.treasure.page,b.treasure.taskInfo.max_times))}),b.treasure.captchaBoxImg[0].crossOrigin="Anonymous",b.treasure.captchaBoxImg.on("load",function(){b.treasure.context.clearRect(0,0,b.treasure.canvas.width,b.treasure.canvas.height),b.treasure.context.drawImage(b.treasure.captchaBoxImg[0],0,0);var a=b.OCR.getGrayscaleMap(b.treasure.context),c=b.OCR.orderFilter2In3x3(a);b.treasure.context.clearRect(0,0,120,40);for(var d=0;d<c.length;++d){var e=c[d];b.treasure.context.fillStyle="rgb("+e+", "+e+", "+e+")",b.treasure.context.fillRect(d%120,Math.round(d/120),1,1)}try{b.treasure.captcha.question=b.treasure.correctQuestion(OCRAD(b.treasure.context.getImageData(0,0,120,40))),b.treasure.captcha.answer=b.eval(b.treasure.captcha.question),b.treasure.captcha.userInput=b.treasure.captcha.answer;var f=b.treasure.captcha.answer;b.treasure.captchaBoxInput.val(f),setTimeout(function(){b.treasure.captchaBoxSubmitButton.click()},1e3)}catch(g){setTimeout(function(){b.treasure.captcha.refresh()},1e3)}}).on("error",function(){b.treasure.captcha.refresh()}),b.treasure.captchaBoxRefreshButton.on("click",function(){b.treasure.captcha.refresh()}),b.treasure.treasureCtrl.find(".bg-cover").on("click",function(){b.treasure.showPanel(),b.treasure.page=b.treasure.taskInfo.times,b.treasure.setInfoSectionPage(b.treasure.taskInfo.times,b.treasure.taskInfo.max_times)}),b.treasure.treasureCtrl.on("click",function(a){return a.preventDefault(),a.stopPropagation(),!1}),b.treasure.treasureCtrl.find(".close-btn").on("click",function(a){return a.preventDefault(),a.stopPropagation(),b.treasure.hidePanel(),!1}),$(document).on("click",function(a){b.treasure.hidePanel()}),b.treasure.captchaBoxSubmitButton.on("click",function(){b.treasure.allowCtrl&&(b.treasure.allowCtrl=!1,b.treasure.submit())}),b.treasure.checkNewTask(!0),$(window).on("beforeunload",function(){chrome.runtime.sendMessage({command:"delTreasure"})})},1e3)})},setInfoSectionPage:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;b.treasure.infoSection.find(".slide-btn.left")[1===a?"hide":"show"](),b.treasure.infoSection.find(".slide-btn.right")[a===c?"hide":"show"](),b.treasure.infoSection.find(".round-count").text("第 "+a+" / "+b.treasure.taskInfo.max_times+" 轮"),b.treasure.treasureCtrl.find(".awarding-panel .info-section .box-slide .round-ctnr").css({transform:"translate(-"+200*(a-1)+"px, 0px)"})},submit:function(){var a=b.treasure.captchaBoxInput.val();a&&b.treasure.getAward(b.treasure.taskInfo.startTime,b.treasure.taskInfo.endTime,a)},showBox:function(){b.treasure.boxHidden&&b.treasure.allowCtrl&&(b.treasure.boxHidden=!1)},hideBox:function(){b.treasure.allowCtrl&&!b.treasure.boxHidden&&(b.treasure.boxHidden=!0)},showPanel:function(){return b.treasure.allowCtrl&&b.treasure.panelHidden?(b.liveQuickLogin(),b.treasure.treasureCtrl.find(".awarding-panel").css({display:"block"}),b.treasure.treasureCtrl.find(".awarding-panel").addClass("v-enter-active","v-enter-to"),setTimeout(function(){b.treasure.treasureCtrl.find(".awarding-panel").removeClass("v-enter-active","v-enter-to"),b.treasure.panelHidden=!1},300),b.treasure.captcha.userInput="",b.treasure.waitingEmoji=b.randomEmoji.happy(),b.treasure.panelEmoji=b.randomEmoji.helpless(),void("acquirable"===b.treasure.status?b.treasure.makeAcquirable():b.treasure.makeWaiting())):void b.treasure.hidePanel()},hidePanel:function(){b.treasure.panelHidden||(b.treasure.allowCtrl=!1,b.treasure.panelOut=!0,b.treasure.treasureCtrl.find(".awarding-panel").addClass("a-scale-out-ease","v-leave-to"),setTimeout(function(){b.treasure.treasureCtrl.find(".awarding-panel").removeClass("a-scale-out-ease","v-leave-to"),b.treasure.treasureCtrl.find(".awarding-panel").css({display:"none"}),b.treasure.panelHidden=!0,b.treasure.panelOut=!1,b.treasure.allowCtrl=!0},300))},makeAcquirable:function(){b.treasure.allowCtrl=!0,b.treasure.statusText.hide(),b.treasure.captchaBox.show(),b.treasure.status="acquirable"},makeWaiting:function(){b.treasure.setInfoSectionPage(b.treasure.taskInfo.times,b.treasure.taskInfo.max_times),b.treasure.treasureCtrl.find(".box-slide .round-ctnr .box-slide-item").removeClass("in-countdown"),b.treasure.treasureCtrl.find(".box-slide .round-ctnr:nth-child("+b.treasure.taskInfo.times+") .box-slide-item:nth-child("+b.treasure.taskInfo.minute/3+")").addClass("in-countdown"),b.treasure.status="waiting"},makeFinished:function(){b.treasure.finished=!0,b.setCookie("F_S_T_"+window.UID,1),b.treasure.treasureCtrl.find(".count-down").text("领完啦"),b.treasure.captchaBoxImg.off("load"),$("#originTreasurePlanel .awarding-panel").hide(),b.treasure.hidePanel(),b.treasure.treasureCtrl.off("click").on("click",function(){b.treasure.checkNewTask(!0)})},checkNewTask:function(a){b.treasure.getCurrentTask().done(function(c){return void 0===c.code?void console.error("接口数据不完整：code 丢失."):(c.code=parseInt(c.code,10),c.code===-10017?void b.treasure.makeFinished():0!==c.code?(console.error("宝箱任务设置失败："+c.msg),c.code===-101||data.code===-99,void b.treasure.makeFinished()):a||b.treasure.taskInfo.minute!==parseInt(c.data.minute,10)?(b.treasure.page=c.data.times,void b.treasure.setNewTask(c.data.times,c.data.max_times,c.data.time_start,c.data.time_end,parseInt(c.data.minute,10),parseInt(c.data.silver,10))):void b.treasure.captcha.refresh())}).fail(function(){console.error("无法获取当前宝箱任务."),setTimeout(function(){return b.treasure.checkNewTask()},1e3)})},setNewTask:function(a,c,d,e,f,g){b.treasure.hidePanel(),b.treasure.statusText.show(),b.treasure.captchaBox.hide(),setTimeout(b.treasure.makeWaiting,300),b.treasure.taskInfo.times=a,b.treasure.taskInfo.max_times=c,b.treasure.taskInfo.startTime=d,b.treasure.taskInfo.endTime=e,b.treasure.taskInfo.minute=f,b.treasure.taskInfo.silver=g,b.treasure.taskInfo.max_times=c,b.treasure.setCountdown(f)},getAward:function(a,c,d){b.treasure.imgInit=!1,$.get("//api.live.bilibili.com/lottery/v1/SilverBox/getAward",{time_start:a,time_end:c,captcha:d},function(){},"json").promise().done(function(a){if(0!=a.code)return b.liveToast(b.treasure.treasureCtrl[0],a.msg+b.randomEmoji.helpless(),"info"),b.treasure.allowCtrl=!0,b.treasure.awardBtn.restore(),void(a.code===-500||(a.code===-902?b.treasure.captcha.refresh():a.code===-10017?b.treasure.makeFinished():b.treasure.checkNewTask()));if(1===parseInt(a.data.isEnd,10))return void b.treasure.makeFinished();b.treasure.updateCurrency(),b.console.watcher("自动领瓜子 成功领取瓜子 "+b.treasure.taskInfo.silver+" 个"),b.treasure.silverSum+=b.treasure.taskInfo.silver,store.set("bilibili_helper_treasure_silver_count",b.treasure.silverSum);var c=new Notification("自动领取成功",{body:"领取了"+b.treasure.taskInfo.silver+"个瓜子",icon:"//static.hdslb.com/live-static/images/7.png"});setTimeout(function(){c.close()},1e4),b.treasure.treasureCtrl.find(".bg-cover").click(),b.treasure.checkNewTask(),b.treasure.awardBtn.restore(),b.treasure.allowCtrl=!0}).fail(function(e){b.console.watcher("系统错误，请稍后再试 "+b.randomEmoji.sad()),b.treasure.awardBtn.restore(),b.treasure.allowCtrl=!0,b.treasure.getAward(a,c,d)}).always(function(){b.treasure.captcha.userInput=""})},updateCurrency:function(){if(!isNaN(parseInt(b.treasure.silverSeed,10))){var a=b.treasure.silverSeed+b.treasure.taskInfo.award;b.treasure.silverSeed=a}},setCountdown:function(a){b.treasure.countdown&&b.treasure.countdown.clearCountdown(),b.treasure.statusText.show(),b.treasure.captchaBox.hide();var c=new Date,d=c.getMinutes()+a;c.setMinutes(d),b.treasure.treasureCtrl.find(".count-down,.countdown-text span:nth-child(4)").text(" "+b.treasure.taskInfo.silver+" "),b.treasure.treasureCtrl.find(".count-down").text("领取中"),b.treasure.countdown=new b.countdown({endTime:c,element:b.treasure.treasureCtrl.find(".countdown-text span:nth-child(2)"),callback:function(){b.treasure.makeAcquirable(),b.treasure.treasureCtrl.find(".bg-cover").click(),b.treasure.captcha.refresh()}}),b.treasure.allowCtrl=!0},correctQuestion:function(a){var c="",a=a.trim();for(var d in a){var e=b.treasure.correctStr[a[d]];c+=void 0!=e?e:a[d]}return"4"==c[2]&&(c[2]="+"),c},getCurrentTask:function(){return $.get("//api.live.bilibili.com/lottery/v1/SilverBox/getCurrentTask",{},function(){},"json").promise()},getCaptcha:function(a){$.get("//api.live.bilibili.com/lottery/v1/SilverBox/getCaptcha?ts="+Date.now(),{},function(){},"json").then(function(b){0===b.code&&a(b.data.img)})}},b.chat={maxLength:20,text:"",beat:!1,colorValue:{white:"0xffffff",red:"0xff6868",blue:"0x66ccff",pink:"0xfca992",cyan:"0x00fffc",green:"0x7eff00",yellow:"0xffed4f",orange:"0xff9800"},danmuMode:{top:5,scroll:1},hideStyle:{chat:{title:"聊天内容",css:".chat-item.danmaku-item{display:none;}",value:"off"},gift:{title:"礼物信息",css:".chat-item.gift-item,.bilibili-live-player-video-area > .bilibili-live-player-video-gift{display:none !important;}",value:"off"},small:{title:"小型标志",css:".chat-item:not(.system-msg) > a{display:none !important;}",value:"off"},vipEnterMsg:{title:"进场消息",css:".chat-item.welcome-msg,.chat-item.welcome-guard{display: none !important;}",value:"off"},liveTitleIcon:{title:"成就头衔",css:".chat-item .title-label{display:none !important;}",value:"off"},mediaIcon:{title:"粉丝勋章",css:".chat-item .fans-medal-item-ctnr{display:none !important;}",value:"off"},userLevel:{title:"用户等级",css:".chat-item .user-level-icon{display:none !important;}",value:"off"},superGift:{title:"礼物连击",css:"#my-dear-haruna-vm{display:none !important;}",value:"off"},announcement:{title:"系统通告",css:".chat-item.system-msg{display:none !important;}",value:"off"}},displayOption:[],init:function(){b.chat.chat_ctrl_panel=$("#chat-control-panel-vm").css("position","relative"),b.chat.counter=b.chat.chat_ctrl_panel.find(".danmu-length-count"),chrome.runtime.sendMessage({command:"getOption",key:"chatDisplay"},function(a){"on"===a.value&&b.chat.initChatDisplay(!0)})},sendDamu:function(){if(b.chat.text.length>0){$(".color-select-panel").attr("data-dd"),$(".mode-select-panel").find("a.active").attr("class").split(" ",3)[1]}},initDanmu:function(){b.chat.maxLength=parseInt(store.get("bilibili_helper_userInfo").userLevel)>=20?30:20,b.chat.counter.text("0 / 1 + 0"),b.scriptOptions.chat={colorValue:b.chat.colorValue,danmuMode:b.chat.danmuMode,maxLength:b.chat.maxLength},b.chat.chat_ctrl_panel.find(".help-chat-shade").hide("middle")},initChatHelper:function(){b.chat.chat_ctrl_panel.find("#chatHelper").remove(),b.chat.chatHelper=$('<div id="chatHelper"></div>').css("background-image","url("+chrome.extension.getURL("imgs/jinkela.png")+")"),b.chat.chatDisplayBlock=$('<div class="chat-display"><h2 class="panel-title">屏蔽选项</h2></div>'),b.chat.chatHelperWindow=$('<div id="chatHelperWindow" class="chat-helper-panel ctrl-panel"></div>').hide(),b.each(b.chat.hideStyle,function(a){var c=$('<div class="display-option"><span class="title">'+b.chat.hideStyle[a].title+'</span><div class="option"><div class="button '+a+("on"===b.chat.hideStyle[a].value?" on":"")+'" option="on">屏蔽</div><div class="button '+a+("off"===b.chat.hideStyle[a].value?" on":"")+'" option="off">显示</div></div></div>');b.chat.chatDisplayBlock.append(c)}),b.chat.chatHelperWindow.append(b.chat.chatDisplayBlock),b.chat.chat_ctrl_panel.append(b.chat.chatHelper,b.chat.chatHelperWindow),b.chat.chatHelper.off("click").on("click",function(){if("none"===b.chat.chatHelperWindow.css("display")){var a=function c(a){var b=a&&(a.target||a.srcElement);!$(b).hasClass("chat-helper-panel")&&!$(b).parents("#chatHelperWindow").length&&$(".chat-helper-panel").fadeOut(200,function(){$(window).off("click",c)})};b.chat.chatHelperWindow.fadeIn(200),setTimeout(function(){$(window).on("click",a)},1)}}),b.chat.chatDisplayBlock.find(".display-option .option .button").off("click").on("click",function(a){var c=$(a.currentTarget),d=$(a.currentTarget).attr("class").split(" ")[1];if(c.hasClass("on"))return!1;$("."+d).removeClass("on"),c.addClass("on");var e=c.attr("option");if("on"===e){var f=b.chat.displayOption.indexOf(d);f===-1&&b.chat.displayOption.push(d)}else{var f=b.chat.displayOption.indexOf(d);f!=-1&&b.chat.displayOption.splice(f,1)}var g=void 0;(g=store.get("bilibili_helper_chat_display"))[b.roomId]=b.chat.displayOption,store.set("bilibili_helper_chat_display",g),b.chat.initChatDisplay()})},initChatDisplay:function(a){chrome.runtime.sendMessage({command:"getOption",key:"displayOption"},function(c){var d=store.get("bilibili_helper_chat_display")[b.roomId]||[],e=d.length?d:[],f=JSON.parse(c.value),g=void 0,h=void 0,i=0;e.length>f.length?(g=e,h=f):(g=f,h=e),i=g.length;for(var j=0;j<g.length;++j)h.indexOf(g[j])>=0&&--i;i?e.length?b.chat.displayOption=e:b.chat.displayOption=f:(store["delete"]("bilibili_helper_chat_display",b.roomId),b.chat.displayOption=f);var k=b.chat.displayOption;b.each(b.chat.hideStyle,function(a){var c=k.indexOf(a);c<0?($(".chatDisplayStyle_"+a).remove(),b.chat.hideStyle[a].value="off"):0===$(".chatDisplayStyle_"+a).length&&(b.chat.addStylesheet(a),b.chat.hideStyle[a].value="on")}),a&&b.chat.initChatHelper()})},addStylesheet:function(a){var c=document.createElement("style");c.setAttribute("class","chatDisplayStyle_"+a),c.setAttribute("type","text/css"),c.appendChild(document.createTextNode(b.chat.hideStyle[a].css)),document.head?document.head.appendChild(c):document.documentElement.appendChild(c)},updateCounter:function(a){var c=parseInt(a.length/b.chat.maxLength),d=c>0?a.length%b.chat.maxLength:0;b.chat.counter.text(a.length+" / "+(0===c?1:c)+" + "+d)}},b.notise={init:function(){var a={};b.getRoomInfo().done(function(c){a.uid=b.roomInfo.info.uid,a.roomId=b.roomInfo.room_id,a.roomShortId=b.roomInfo.short_id,a.upName=b.roomInfo.info.uname,a.url=location.href;var d=$("<div>").addClass("fav-part dp-i-block pointer p-relative").append('<i class="icon-font icon-attention v-middle icon-attention" style="top: 1px"></i><span class="follow-text v-middle d-inline-block">特别关注</span>').click(function(b){$(b.currentTarget).find("i").hasClass("favourited")?chrome.runtime.sendMessage({command:"setNotFavourite",id:a.roomId},function(a){a.data&&(d.find("span").html("特别关注"),d.find("i").removeClass("favourited"))}):chrome.runtime.sendMessage({command:"setFavourite",upInfo:a},function(a){a.data&&d.find("span").html("已特别关注"),d.find("i").addClass("favourited")})}).hover(function(a){$(a.currentTarget).attr("title","关注之后再特别关注会在主播开播时进行推送哦"+b.randomEmoji.happy())});chrome.runtime.sendMessage({command:"getFavourite"},function(a){a.data.indexOf(parseInt(b.roomId))!=-1&&(d.find("span").html("已特别关注"),d.find("i").addClass("icon-solid-heart"))}),$(".attention-btn-ctnr").prepend(d)})}},b.smallTV={tvList:{},count:0,reward:{},rewardList:{1:{title:"大号小电视"},2:{title:"蓝白胖次道具"},3:{title:"B坷垃"},4:{title:"喵娘"},5:{title:"便当"},6:{title:"银瓜子"},7:{title:"辣条"}},init:function(){b.smallTV.reward=store.get("bilibili_helper_tvs_reward"),b.smallTV.count=store.get("bilibili_helper_tvs_count")},getTVdata:function(a){if(b.smallTV.tvList[a]){var c=void 0!=a?b.smallTV.tvList[a].iter:void 0,d=void 0!=c&&b.smallTV.tvList[a].tv[c];return d}},get:function(a){$.getJSON("/SmallTV/index",{roomid:a,_:(new Date).getTime()}).promise().done(function(c){if(0==c.code)if(c.data.unjoin.length||c.data.join.length,b.console.watcher("监测到小电视抽奖活动 直播间【"+a+"】"),c.data.lastid)b.console.watcher("小电视活动 直播间【"+a+"】 抽奖已经结束");else{b.console.watcher("小电视活动 直播间【"+a+"】 成功获取抽奖信息");var d=c.data.unjoin;void 0==b.smallTV.tvList[a]&&(b.smallTV.tvList[a]={tv:[],iter:0});for(var e=0;e<d.length;++e){var f=d[e];f.finished=!1,f.joined=!1,f.drawIn=!1,b.smallTV.tvList[a].tv.push(f),b.smallTV.notify(a)}}}).fail(function(c){b.smallTV.get(a)})},notify:function(a){$.getJSON("/SmallTV/index",{roomid:a,_:(new Date).getTime()}).promise().done(function(c){if(0==c.code)if(c.data.unjoin.length||c.data.join.length,b.console.watcher("监测到小电视抽奖活动 直播间【"+a+"】"),c.data.lastid)b.console.watcher("小电视活动 直播间【"+a+"】 抽奖已经结束");else{b.console.watcher("小电视活动 直播间【"+a+"】 成功获取抽奖信息");var d=c.data.unjoin;void 0==b.smallTV.tvList[a]&&(b.smallTV.tvList[a]={tv:[],iter:0}),d.length>0&&chrome.runtime.sendMessage({command:"tvNotification",data:{roomId:a}},function(a){})}}).fail(function(c){b.smallTV.notify(a)})}},b.watcher={able:!1,options:{tv:!1},notifyStatus:!1,notifyOptions:{tv:!1},panelDOM:{ty:void 0},init:function(a){chrome.runtime.sendMessage({command:"getOption",key:"watcher"},function(c){"on"===c.value&&setTimeout(function(){
chrome.runtime.sendMessage({command:"getWatcherRoom"},function(c){void 0===c.data.roomId?(b.getRoomInfo().done(function(a){chrome.runtime.sendMessage({command:"setWatcherRoom",data:{uid:a.data.UID,roomId:a.data.ROOMID,roomShortId:b.roomInfo.short_id,upName:a.data.ANCHOR_NICK_NAME,url:location.href}})}),chrome.runtime.sendMessage({command:"getOption",key:"watchList"},function(c){var d=c.value?JSON.parse(c.value):[];b.scriptOptions.watcher=[],b.each(d,function(a){var c=b.watcher.options[d[a]];c===!1&&(b.watcher.options[d[a]]=!0,b.scriptOptions.watcher.push(d[a]),b.console.watcher("启动:"+d[a]))}),b.watcher.initRewardPanel(),$(window).on("beforeunload",function(a){chrome.runtime.sendMessage({command:"delWatcherRoom"})}),b.watcher.options.tv&&(b.smallTV.init(),b.watcher.updateReward("tv")),document.addEventListener("sendMessage",function(a){var c=store.get("bilibili_helper_message");return!!c.cmd&&void b.watcher.classify(c)}),b.watcher.initData(),"function"==typeof a&&a()}),chrome.runtime.sendMessage({command:"getOption",key:"watchNotify"},function(a){b.watcher.notifyStatus="on"===a.value}),chrome.runtime.sendMessage({command:"getOption",key:"watchNotifyList"},function(a){var c=a.value?JSON.parse(a.value):[];b.each(c,function(a){var d=b.watcher.notifyOptions[c[a]];d||(b.watcher.notifyOptions[c[a]]=!0)})})):(chrome.runtime.sendMessage({command:"getOption",key:"watchList"},function(a){var c=a.value?JSON.parse(a.value):[];b.each(c,function(a){b.watcher.options[c[a]]=!0}),b.watcher.initRewardPanel()}),"function"==typeof a&&a()),b.watcher.able=!0})},2e3)})},initData:function(){chrome.runtime.sendMessage({command:"getOption",key:"watcherDataClean"},function(a){var c=store.get("bilibili_helper_watcher_data_date"),d=(new Date).getFullYear(),e=(new Date).getMonth()+1,f=(new Date).getDate(),g=d+"-"+e+"-"+f;"0"!==a.value&&("1"===a.value?(void 0===c?b.watcher.cleanData():c!=g&&b.watcher.cleanData(),store.set("bilibili_helper_watcher_data_date",g)):"2"===a.value&&(!c||b.getDateDiff(c,g)>=7)&&(b.watcher.cleanData(),store.set("bilibili_helper_watcher_data_date",g)))})},cleanData:function(){store.set("bilibili_helper_tvs_reward",{}),store.set("bilibili_helper_tvs_count",0),store.set("bilibili_helper_lottery_reward",{}),store.set("bilibili_helper_lottery_count",0)},classify:function(a){switch(a.cmd){case"DANMU_MSG":b.console.info("danmu",a);break;case"SYS_MSG":b.console.info("system",a),b.watcher.options.tv&&b.watcher.dealWithSysMsg(a);break;case"TV_END":break;case"SEND_GIFT":b.console.info("gift",a);break;case"SYS_GIFT":b.console.info("sys_gift",a),b.watcher.options.lottery&&b.watcher.dealWithSysGift(a)}},dealWithSysMsg:function(a){var c=a.msg;if("【"===c[0]&&""!=a.url&&1===a.rep&&2===a.styleType){var d=new RegExp("【([\\S]+)】在直播间【([\\d]+)】"),e=d.exec(c),f=e[2];b.getRoomIdByUrl(f,function(a){b.smallTV.notify(a)})}},dealWithSysGift:function(a){var c=a.tips;if("string"==typeof c||a.giftId)switch(a.giftId){case 39:var d=new RegExp("在直播间【([0-9]+)】"),e=d.exec(c),f=e[1];b.getRoomIdByUrl(f,function(a){b.beat.getBeat(a).done(function(c){if(c.data[39].id){var d=c.data[39].content;b.beat.sendBeat(a,d);var e=b.lottery.reward[6];void 0===e&&(e=0),b.lottery.reward[6]=++e,store.set("bilibili_helper_lottery_reward",b.lottery.reward),b.watcher.updateReward("lottery")}})})}},pushNotification:function(a,b,c,d){var e=new Notification(b,{body:c,icon:d});setTimeout(function(){e.close()},5e3)},initRewardPanel:function(){if(b.watcher.options.tv){b.watcher.panelDOM.tv=$("<div />").addClass("tv reward-panel");var a=$("<span />").addClass("reward-counter"),c=$("<div />").addClass("reward-title").text("小电视抽奖").append(a),d=$("<div />").addClass("reward-container");b.watcher.panelDOM.tv.append(c,d)}},updateReward:function(a){var c={},d=0,e=void 0;if(b.watcher.able){switch(a){case"tv":c=store.get("bilibili_helper_tvs_reward"),d=store.get("bilibili_helper_tvs_count"),e=b.smallTV.rewardList}if(e&&b.watcher.panelDOM[a]){b.watcher.panelDOM[a].find(".reward-container").empty();var f=0;b.each(c,function(d){++f;var g=e[d]?e[d].title:b.giftList[d]?b.giftList[d].title:"神秘礼物",h=c[d],i=$("<span />").addClass("gift").text(g+"x"+b.numFormat(h));b.watcher.panelDOM[a].find(".reward-container").append(i)}),f||b.watcher.panelDOM[a].find(".reward-container").append($('<span class="gift">没有获奖记录</span>'))}b.watcher.panelDOM[a]&&b.watcher.panelDOM[a].find(".reward-counter").text(d+" 次")}}},b.giftpackage={giftPackageStatus:0,giftPackageData:{},giftList:{},giftPackageNewPanel:{data:[],show:!1,out:!1,outTimeout:null,open:function(){b.giftpackage.getSendGift(function(a){0===a.code&&(b.giftpackage.giftPackageNewPanel.data=a.data)})},close:function(){var a=b.giftpackage.giftPackageNewPanel;a.out=!0,a.outTimeout=setTimeout(function(){a=null,b.giftpackage.giftPackageStatus=2},380)}},init:function(){chrome.runtime.sendMessage({command:"getOption",key:"giftpackage"},function(a){"on"===a.value&&(b.giftpackage.getGiftList(),b.giftpackage.originCtl=$("#gift-control-vm .gift-package").hide(),b.giftpackage.ctl=b.giftpackage.originCtl.clone().css({display:"inline-block"}).attr("id","helper-gift-ctl"),b.giftpackage.ctl.children().not(".warp").on("click",function(a){a.stopPropagation(),b.giftpackage.mainPanel.toggle(a)}),b.giftpackage.originCtl.after(b.giftpackage.ctl).hide(),b.giftpackage.mainPanel.initDOM(),b.giftpackage.sendPanel.initDOM(),b.giftpackage.mainPanel.update(function(){b.giftpackage.mainPanel.createPanel()}))})},mainPanel:{state:!1,update:function(a){b.giftpackage.getGiftPackage().done(function(c){0===c.code&&(c.data&&0===c.data.length?(b.giftpackage.giftPackageData={},b.giftpackage.mainPopupBoxEmptyBox.show(),b.giftpackage.sendAllBtn.hide()):(b.giftpackage.giftPackageData=b.giftpackage.sortGifts(c.data.list),b.giftpackage.mainPopupBoxEmptyBox.hide(),b.giftpackage.sendAllBtn.show()),"function"==typeof a&&a(c))})},open:function(){b.giftpackage.mainPanel.update(function(){b.giftpackage.mainPanel.createPanel(),b.giftpackage.mainPanel.show()})},show:function(){b.giftpackage.mainPanel.state=!0,b.giftpackage.mainBox.fadeIn("fast"),setTimeout(function(){b.giftpackage.mainBox.removeClass("slide-fade-enter-active v-enter-to")},380),setTimeout(function(){var a=function c(a){var d=a&&(a.target||a.srcElement);$(d).hasClass("gift-package")&&$(d).hasClass("link-popup-ctnr")||$(d).parents(".gift-package,.link-popup-ctnr").length||(b.giftpackage.mainPanel.hide(),$(document).off("click",c))};$(document).on("click",a)},1)},hide:function(){b.giftpackage.mainPanel.state=!1,b.giftpackage.mainBox.addClass("slide-fade-leave-active slide-fade-leave-to"),setTimeout(function(){b.giftpackage.mainBox.hide(),b.giftpackage.mainBox.removeClass("slide-fade-leave-active slide-fade-leave-to")},380)},toggle:function(a){a.stopPropagation(),b.liveQuickLogin(),b.giftpackage.mainPanel.state?b.giftpackage.mainPanel.hide():1===b.giftpackage.giftPackageStatus||b.giftpackage.mainPanel.open()},initDOM:function(){b.giftpackage.mainBox=$("<div />").addClass("warp slide-fade-enter-active v-enter-to").hide(),b.giftpackage.mainBoxInner=$("<div />").addClass("common-popup-wrap arrow-bottom popup"),b.giftpackage.mainPopupBoxInner=$("<div />").addClass("box"),b.giftpackage.mainPopupBoxHeader=$("<header />").append("道具包裹"),b.giftpackage.sendAllBtn=$("<div />").addClass("send-all").text("一键清空"),b.giftpackage.sendIntimacyBtn=$("<div />").addClass("send-intimacy").text("满亲密度清空"),b.giftpackage.mainPopupBoxGiftBox=$("<div />").addClass("a-move-in-left"),b.giftpackage.mainPopupBoxGiftWapper=$("<div />").addClass("content"),b.giftpackage.sendLineBtn=$("<div />").addClass("send-line").text("清空本类"),b.giftpackage.mainPopupBoxGiftItemBox=$("<div />").addClass("item-box"),b.giftpackage.mainPopupBoxGiftItem=$("<div />").addClass("gift-box item"),b.giftpackage.mainPopupBoxGiftItemIcon=$("<div />").addClass("gift bg-cover"),b.giftpackage.mainPopupBoxGiftItemNum=$("<div />").addClass("num"),b.giftpackage.mainPopupBoxGiftItemExpires=$("<span />").addClass("expires"),b.giftpackage.mainPopupBoxEmptyBox=$("<div />").append($("<div />").addClass("des").text("包裹中没有道具哦～"),$("<img />").addClass("img").attr("src","//s1.hdslb.com/bfs/static/blive/blfe-live-room/static/img/404.6c08e48.png")).hide(),b.giftpackage.mainPopupBoxHeader.append(b.giftpackage.sendAllBtn,b.giftpackage.sendIntimacyBtn),b.giftpackage.mainBox.append(b.giftpackage.mainBoxInner),b.giftpackage.mainBoxInner.append(b.giftpackage.mainPopupBoxInner),b.giftpackage.mainPopupBoxInner.append(b.giftpackage.mainPopupBoxHeader,b.giftpackage.mainPopupBoxGiftBox,b.giftpackage.mainPopupBoxEmptyBox),b.giftpackage.ctl.find(".wrap").remove(),b.giftpackage.ctl.append(b.giftpackage.mainBox)},createPanel:function(a){if(a=a||b.giftpackage.giftPackageData){b.giftpackage.sendAllBtn.data("giftsData",a),b.giftpackage.sendIntimacyBtn.data("giftsData",a),b.giftpackage.mainPopupBoxGiftBox.empty();var c=Object.keys(a);c.length>0?b.each(a,function(c){var d=a[c],e=b.giftpackage.mainPopupBoxGiftWapper.clone().on("DOMMouseScroll mousewheel",b.scrollEvent),f=b.giftpackage.sendLineBtn.clone().data("giftsData",d),g=b.giftpackage.mainPopupBoxGiftItemBox.clone();b.each(d,function(a){var e=d[a],f=b.giftpackage.mainPopupBoxGiftItem.clone().data("giftData",e),h=b.giftpackage.mainPopupBoxGiftItemIcon.clone();h.css({"background-image":'url("//s1.hdslb.com/bfs/static/blive/blfe-live-room/static/img/gift-images/image-png/gift-'+c+'.png")'});var i=b.giftpackage.mainPopupBoxGiftItemExpires.clone().text(e.day),j=b.giftpackage.mainPopupBoxGiftItemNum.clone().text(e.gift_num);f.append(i,h,j).data("giftData",e),g.append(f)}),e.append(f,g),b.giftpackage.mainPopupBoxGiftBox.append(e),f.on("click",function(){var a=$(this).data("giftsData");b.giftpackage.sendPanel.createPanel({data:a})})}):b.giftpackage.mainPopupBoxEmptyBox.show()}b.giftpackage.ctl.find(".gift-box.item").off("click").on("click",function(a){var c=$(this).data("giftData");b.giftpackage.sendPanel.createPanel({data:c,single:!0})}),b.giftpackage.sendAllBtn.off("click").on("click",function(a){var c=$(this).data("giftsData");b.giftpackage.sendPanel.createPanel({data:c,all:!0})}),b.giftpackage.sendIntimacyBtn.off("click").on("click",function(a){return})}},sendPanel:{showState:!1,sendState:!1,data:{},show:function(){b.giftpackage.sendPanel.showState=!0,b.giftpackage.linkPopupCtl.empty().append(b.giftpackage.linkPopupCtlInner)},hide:function(){b.giftpackage.sendPanel.showState=!1,b.giftpackage.linkPopupCtlInner.addClass("fade-ut-leave-active fade-out-leave-to"),b.giftpackage.linkBox.addClass("a-scale-out scale-out-leave-to"),setTimeout(function(){b.giftpackage.linkPopupCtlInner.removeClass("fade-ut-leave-active fade-out-leave-to"),b.giftpackage.linkBox.removeClass("a-scale-out scale-out-leave-to"),b.giftpackage.linkPopupCtl.empty()},380)},toggle:function(a){a.stopPropagation(),b.liveQuickLogin(),b.giftpackage.sendPanel.showState?b.giftpackage.sendPanel.hide():b.giftpackage.sendPanel.open()},initDOM:function(){b.giftpackage.linkPopupCtl=$("<div />").addClass("link-popup-ctnr"),b.giftpackage.linkPopupCtlInner=$("<div />").addClass("link-popup-ctnr dp-table w-100 h-100 p-fixed p-zero f-family"),b.giftpackage.linkPopupCtlMerge=$("<div />").addClass("body-merge w-100 h-100 p-absolute p-zero"),b.giftpackage.linkPopupCtlBox=$("<div />").addClass("dp-table-cell v-middle"),b.giftpackage.linkBox=$("<div />").addClass("link-popup-panel p-relative m-auto a-move-in-top a-forwards"),b.giftpackage.linkBoxHeader=$("<div />").addClass("title-ctnr p-relative"),b.giftpackage.linkBoxH2=$('<div><h2 class="popup-title">赠送礼物</h2></div>').addClass("title-ctnr p-relative"),b.giftpackage.linkBoxClose=$('<div><i data-v-599b0ddc="" class="close icon-font icon-close"></i></div>').addClass("close-btn p-absolute bg-center bg-no-repeat pointer t-center"),b.giftpackage.linkBoxContentWapper=$("<div />").addClass("popup-content-ctnr"),b.giftpackage.linkBoxContent=$("<div />").addClass("gift-sender"),b.giftpackage.linkBoxForm=$("<div />").addClass("sender-form"),b.giftpackage.linkBoxGiftInfo=$("<div />").addClass("gift-info"),b.giftpackage.intimacyCheckBox=$('<input type="checkbox" name="intimacy" />'),b.giftpackage.intimacyLabel=$("<label/>").append(b.giftpackage.intimacyCheckBox),b.giftpackage.linkBoxGiftInfoIcon=$("<div />").addClass("img bg-cover dp-i-block v-top"),b.giftpackage.linkBoxGiftInfoDesc=$("<div />").addClass("desc dp-i-block v-top"),b.giftpackage.linkBoxGiftSubmitBox=$("<div />"),b.giftpackage.linkBoxGiftSubmitInput=$("<input />").attr("type","number").addClass("input no-switcher"),b.giftpackage.linkBoxGiftSubmitButton=$('<button><span class="txt">赠送</span></button>').addClass("bl-button bl-button--primary bl-button--size"),b.giftpackage.medal=$('<div class="fans-medal-item v-middle"><span class="label"></span><span class="level"></span></div>'),$("body").append(b.giftpackage.linkPopupCtl),b.giftpackage.linkPopupCtlInner.append(b.giftpackage.linkPopupCtlMerge,b.giftpackage.linkPopupCtlBox),b.giftpackage.linkPopupCtlBox.append(b.giftpackage.linkBox),b.giftpackage.linkBoxHeader.append(b.giftpackage.linkBoxH2),b.giftpackage.linkBoxContentWapper.append(b.giftpackage.linkBoxContent),b.giftpackage.linkBoxContent.append(b.giftpackage.linkBoxForm),b.giftpackage.linkBoxForm.append(b.giftpackage.linkBoxGiftInfo),b.giftpackage.linkBox.append(b.giftpackage.linkBoxHeader,b.giftpackage.linkBoxContentWapper,b.giftpackage.linkBoxClose),b.giftpackage.linkBoxGiftSubmitBox.append(b.giftpackage.linkBoxGiftSubmitInput,b.giftpackage.linkBoxGiftSubmitButton)},createNumberBox:function(a,b){for(var c=["1","5","10","30","50","5%","10%","30%","50%","MAX"],d=$("<div />").addClass("number-btn-box"),e=0;e<c.length;++e){var f=$("<span />").addClass("number-btn").text(c[e]);e<5&&b<parseInt(c[e])&&f.addClass("disabled"),d.append(f),f.off("click").on("click",function(){var c=$(this).text();switch(c){case"1":case"5":case"10":case"30":case"50":var d=parseInt(c);b<d&&(d=b),a.val(d);break;case"5%":case"10%":case"30%":case"50%":var d=Math.ceil(.01*parseInt(c.substr(0,c.length-1))*b);b<d&&(d=b),a.val(d);break;case"MAX":a.val(b)}a.focus()})}return d},createSingleTypeDOM:function(a){var c=b.giftpackage.linkBoxGiftInfoIcon.clone().css({"background-image":"url(//s1.hdslb.com/bfs/static/blive/blfe-live-room/static/img/gift-images/image-gif/gift-"+a.gift_id+".gif)"}),d=b.giftpackage.linkBoxGiftInfoDesc.clone().text("您的包裹中还剩 "+a.gift_num+" 个可用"),e=b.giftpackage.linkBoxGiftInfo.clone().append(c,d),f=b.giftpackage.linkBoxGiftSubmitBox.clone(),g=f.find("input").val(1),h=b.giftpackage.sendPanel.createNumberBox(g,a.gift_num);b.giftpackage.linkBoxForm.empty().append(e,f,h),setTimeout(function(){g.focus()},380),f.find("button").on("click",function(c){b.giftpackage.sendPanel.send(c,a)})},createTypeDOM:function(a,c){var d=b.giftpackage.mainPopupBoxGiftItemBox.clone(),e=[],f=function(a){b.each(a,function(c){var f=a[c];e.push(f);var g=b.giftpackage.mainPopupBoxGiftItem.clone().data("giftData",f),h=b.giftpackage.mainPopupBoxGiftItemIcon.clone();h.css({"background-image":'url("//s1.hdslb.com/bfs/static/blive/blfe-live-room/static/img/gift-images/image-png/gift-'+f.gift_id+'.png")'});var i=b.giftpackage.mainPopupBoxGiftItemExpires.clone().text(f.day),j=b.giftpackage.mainPopupBoxGiftItemNum.clone().text(f.gift_num);g.append(i,h,j).data("giftData",f),d.append(g)})};if(c){var g=Object.keys(a);b.each(g,function(b){var c=a[g[b]];f(c)})}else f(a);var h=b.giftpackage.linkBoxGiftInfo.clone().append(d).on("DOMMouseScroll mousewheel",b.scrollEvent),i=b.giftpackage.linkBoxGiftSubmitBox.clone().empty().append(b.giftpackage.linkBoxGiftSubmitButton.clone());b.giftpackage.linkBoxForm.empty().append(h,i),i.find("button").on("click",function(d){c?b.giftpackage.sendPanel.sendAll(d,a):b.giftpackage.sendPanel.sendLine(d,a)})},createPanel:function(a){var c=a.data,d=a.single,e=void 0!==d&&d,f=a.all,g=void 0!==f&&f;if(e===!0)b.giftpackage.sendPanel.createSingleTypeDOM(c);else{if(e)return;b.giftpackage.sendPanel.createTypeDOM(c,g)}b.giftpackage.sendPanel.show(),b.giftpackage.linkBoxClose.on("click",function(a){a.stopPropagation(),b.giftpackage.sendPanel.hide()}),b.giftpackage.linkPopupCtlMerge.on("click",function(a){a.stopPropagation(),b.giftpackage.sendPanel.hide()})},send:function(a,c){if("keyup"===a.type&&13!==a.keyCode)return void(b.giftpackage.sendPanel.sendState=!1);var d=a.target||a.srcElement,e=b.giftpackage.linkPopupCtlBox.find("input");if(b.giftpackage.sendPanel.sendState)return d&&b.liveToast(e[0],b.randomEmoji.sad()+" 送礼失败：有礼物正在派送中 "+b.randomEmoji.sad(),"error"),void(b.giftpackage.sendPanel.sendState=!1);b.giftpackage.sendPanel.sendState=!0;var f=c;f.count=e.val();var g=parseInt(f.count,10);return isNaN(g)||g>f.gift_num?(f.count=0,b.liveToast(d,"请填写正确的礼物数量 "+b.randomEmoji.helpless(),"error"),void(b.giftpackage.sendPanel.sendState=!1)):b.giftpackage.sendPanel.sendAjax(f,d,e)},sendLine:function(a,c){if("keyup"===event.type&&13!==event.keyCode)return void(b.giftpackage.sendPanel.sendState=!1);var d=event.target||event.srcElement;if(b.giftpackage.sendPanel.sendState)return d&&b.liveToast(d,b.randomEmoji.sad()+" 送礼失败：有礼物正在派送中 "+b.randomEmoji.sad(),"error"),void(b.giftpackage.sendPanel.sendState=!1);if(c instanceof Array){var e=c.length-1;return b.giftpackage.sendPanel.sendLineAjax(e,c,d)}d&&b.liveToast(d,b.randomEmoji.sad()+" 送礼失败：礼物数据有误 "+b.randomEmoji.sad(),"error")},sendAll:function(a,c){if("keyup"===a.type&&13!==a.keyCode)return void(b.giftpackage.sendPanel.sendState=!1);var d=a.target||a.srcElement;if(b.giftpackage.sendPanel.sendState)return d&&b.liveToast(d,b.randomEmoji.sad()+" 送礼失败：有礼物正在派送中 "+b.randomEmoji.sad(),"error"),void(b.giftpackage.sendPanel.sendState=!1);if(c instanceof Object){var e=Object.keys(c),f=e.length;return b.giftpackage.sendPanel.sendAllAjax(f-1,c,d)}d&&b.liveToast(d,b.randomEmoji.sad()+" 送礼失败：礼物数据有误 "+b.randomEmoji.sad(),"error")},sendAjax:function(a,c,d){var e=store.get("bilibili_helper_live_danmu_rnd")[b.roomInfo.short_id||b.roomInfo.room_id];return $.post("//api.live.bilibili.com/gift/v2/live/bag_send",{uid:b.user.info.uid,gift_id:a.gift_id,ruid:b.roomInfo.uid,gift_num:a.count,bag_id:a.bag_id,platform:"pc",biz_code:"live",biz_id:b.roomInfo.room_id,rnd:e,storm_beat_id:0,csrf_token:b.getCookie("bili_jct")||""},function(e){b.giftpackage.sendPanel.successCallback(a,e,c,d)},"json").fail(function(a){c&&b.liveToast(c,b.randomEmoji.sad()+" 送礼失败："+a.statusText+" "+b.randomEmoji.sad(),"error")}).always(function(){b.giftpackage.sendPanel.sendState=!1})},sendLineAjax:function(a,c,d){var e=void 0;if(a!==-1){var f=c[a];f.count=f.gift_num,e=b.giftpackage.sendPanel.sendAjax(f,d),e.done(function(a){f.complete=0===a.code}).fail(function(){f.complete=!1}).always(function(){b.giftpackage.sendPanel.sendLineAjax(a-1,c)})}else b.giftpackage.mainPanel.hide();return e},sendAllAjax:function(a,c,d){if(c instanceof Object){var e=void 0;if(a!==-1){var f=Object.keys(c),g=c[f[a]],h=g.length;e=b.giftpackage.sendPanel.sendLineAjax(h-1,g,d),e&&e.always(function(){b.giftpackage.sendPanel.sendAllAjax(a-1,c,d)})}return e}b.giftpackage.mainPanel.hide()},successCallback:function(a,c,d,e){if(0===c.code){var f=function(a){var b={uname:a.uname,num:a.gift_num,giftName:a.gift_name,giftId:a.gift_id};g.innerHTML='<div class="penury-gift-item v-middle a-move-in-top"><span class="username v-middle">'+b.uname+'</span> <span class="action v-middle">喂食'+b.giftName+'</span><div class="gift-img dp-i-block v-middle bg-contain live-gift-image gift-gray-'+b.giftId+'" role="img"></div>X <span class="gift-count">'+b.num+"</span></div>",setTimeout(function(){g.innerHTML=""},3e3)};b.liveToast(d,"送出去啦～诶嘿嘿"+b.randomEmoji.helpless(),"success"),b.console.watcher("成功送出 "+c.data.gift_name+" x "+c.data.gift_num);var g=document.getElementById("penury-gift-msg");parseInt(c.data.gift_num,10)<10&&f(c.data),a.giftNum=c.data.extra.gift_bag.gift_num,b.giftpackage.linkPopupCtlBox.find(".gift-info .desc.dp-i-block.v-top").text("您的包裹中还剩 "+c.data.extra.gift_bag.gift_num+" 个可用"),e&&e.focus(),0===a.giftNum&&(b.liveToast(d,"已经没有道具了 "+b.randomEmoji.sad(),"error","caution"),e&&e.val(0),b.giftpackage.sendPanel.hide())}else 1===c.code?console.error("系统繁忙..."):c.code===-400&&"余额不足"===c.msg?b.giftpackage.sendPanel.hide():d&&b.liveToast(d,c.msg+" "+b.randomEmoji.sad(),"error")}},giftFilter:{},sortGifts:function(a){var c={},d=a;b.giftpackage.giftPackageData={};var e=new Date;e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);var f=(new Date).setTime(e.getTime())/1e3;return b.each(d,function(a){var e=d[a];if(b.giftpackage.giftPackageData[e.id]=e,0===e.expire_at)e.expireatDate=-1,e.day="永久";else{var g=e.expire_at-f,h=parseInt(g/60/60/24,10);e.expireatDate=h,h>1?e.day=h+"天":e.day="今天"}void 0===c[e.gift_id]&&(c[e.gift_id]=[]);var i=0;b.each(c[e.gift_id],function(a){e.expireatDate<c[e.gift_id][a].expireatDate&&i>=a?i=a:i>=a&&(i=a+1)}),c[e.gift_id].splice(i,0,e)}),c},filterGiftsByIntimacy:function(a){var c=a;b.giftpackage.giftPackageData={};var d=0;return{data:_.sortBy(c,[function(a){return d+=b.giftpackage.giftList[a.gift_id].price/100*a.gift_num,a.expireatDate}]),intimacy:d}},getGiftPackage:function(){return $.get("//api.live.bilibili.com/gift/v2/gift/bag_list",{},function(){},"json").promise()},getSendGift:function(){return $.get("//api.live.bilibili.com/giftBag/getSendGift",{},function(){},"json").promise()},getGiftPackageStatus:function(){return $.get("//api.live.bilibili.com/giftBag/sendDaily",{},function(){},"json").promise()},getGiftList:function(){return $.get("https://api.live.bilibili.com/gift/v2/live/room_gift_list",{},function(a){0===a.code&&_.forEach(a.data,function(a){b.giftpackage.giftList[a.id]=a})},"json").promise()}},b.medal=(a={medalList:{},wearedMedal:{},hasMedal:!1},_defineProperty(a,"hasMedal",function(){return _.filter(b.medalList.fansMedalList,function(a){return a.anchorInfo.uname===b.roomInfo.info.uname}).length>0}),_defineProperty(a,"hasWeared",function(){return b.roomInfo.info.uname===b.medal.wearedMedal.target_name}),_defineProperty(a,"getMedalList",function(){return $.getJSON("//api.live.bilibili.com/i/api/medal?page=1&pageSize=30").promise()}),_defineProperty(a,"getWearedMedal",function(){return $.post("//api.live.bilibili.com/live_user/v1/UserInfo/get_weared_medal",{source:1,uid:b.user.info.uid,target_id:b.roomId,csrf_token:b.getCookie("bili_jct")||""}).promise()}),_defineProperty(a,"wearMedal",function(a){return $.getJSON("//api.live.bilibili.com/i/ajaxWearFansMedal?medal_id="+a).promise()}),_defineProperty(a,"cancelWear",function(){return $.getJSON("//api.live.bilibili.com/i/ajaxCancelWear").promise()}),_defineProperty(a,"deleteMedal",function(a){return $.getJSON("//api.live.bilibili.com/i/ajaxDeleteMyFansMedal?medal_id="+a).promise()}),_defineProperty(a,"updateMedalList",function(){b.medal.getMedalList().done(function(a){b.medalList=a.data})}),_defineProperty(a,"updateWearedMedal",function(a){b.medal.getWearedMedal().done(function(c){0===c.code&&(b.medal.wearedMedal=c.data,a instanceof Function&&a())})}),_defineProperty(a,"init",function(a){b.medal.updateMedalList(),b.medal.updateWearedMedal(),a instanceof Function&&a()}),a),b.silver2coin={init:function(){chrome.runtime.sendMessage({command:"getOption",key:"silver2coin"},function(a){"on"===a.value&&$.get("//api.live.bilibili.com/pay/v1/Exchange/silver2coin",{platform:"pc",csrf_token:b.getCookie("bili_jct")},function(){},"json").then(function(a){if(0===a.code){var b=new Notification(data.msg,{body:"银瓜子兑换成功"});setTimeout(function(){b.close()},1e4)}})})}},b.init={"do":function(){b.init.localStorage(),b.init.ad(),b.roomId=b.getRoomIdByUrl(),b.init.userInfo(function(){if(store.get("bilibili_helper_login")){var a=b.getRoomIdByUrl();a&&!isNaN(a)&&chrome.runtime.sendMessage({command:"getOption",key:"version"},function(a){b.version=a.value;var c=store.get("bilibili_helper_version");c&&c==b.version||store.set("bilibili_helper_version",b.version),$(".seeds-wrap").prepend('<div class="version"><span title="version: '+b.version+'">哔哩哔哩助手</span> by <a href="http://weibo.com/guguke" target="_blank">@啾咕咕www</a> <a href="http://weibo.com/ruo0037" target="_blank">@沒睡醒的肉啊</a></div>'),b.init.style(),b.addScriptByText('(function(){const urlId = parseInt(/^\\/([\\d]+)/.exec(location.pathname)[1], 10); if (urlId && !isNaN(urlId)) {var a=function(f,d,c){if(!window.localStorage||!f){return}var e=window.localStorage;if(!e[f]){e[f]=JSON.stringify({})}var b=JSON.parse(e[f]);if(c==undefined){e[f]=typeof d=="string"?d.trim():JSON.stringify(d)}else{b[d]=typeof c=="string"?c.trim():JSON.stringify(c);e[f]=JSON.stringify(b)}};a("bilibili_helper_live_roomId",urlId,window.BilibiliLive.ROOMID);a("bilibili_helper_live_danmu_rnd",urlId,DANMU_RND);}})();'),b.getRoomInfo().done(function(a){b.init.giftList(),b.roomInfo=a.data,b.getAnchorInRoom().done(function(a){0===a.code&&Object.assign(b.roomInfo,a.data)}),b.roomInfo.roomShortId=location.pathname.substr(1),setTimeout(function(){b.doSign.init(),b.silver2coin.init(),b.chat.init(),b.notise.init(),b.giftpackage.init(),b.treasure.init(),b.watcher.init(),$(".wish-box .close").click()},2500),setTimeout(function(){b.addScriptByFile("live-content-script.min.js",b.scriptOptions)},5e3),Notification.requestPermission()})})}})},style:function(){var a=$("document").find("#bilibiliHelperLive");a.length&&a.remove(),b.init.inject_css("bilibiliHelperLive","live.min.css")},inject_css:function(a,b){var c=document.createElement("link");c.setAttribute("id",a),c.setAttribute("type","text/css"),c.setAttribute("rel","stylesheet"),c.setAttribute("href",chrome.extension.getURL(b)),document.head?document.head.appendChild(c):document.documentElement.appendChild(c)},ad:function(){chrome.runtime.sendMessage({command:"getAd"},function(a){"on"===a.value&&b.init.inject_css("bilibiliHelperAdStyle","bilibiliHelperAd.min.css")})},giftList:function(){var a=$(".gifts-ctnr .gift-item[role=listitem]");if(a.length>0)for(var c=0;c<a.length;++c){var d=$(a[c]),e=d.attr("data-gift-id");isNaN(parseInt(e))||(b.giftList[e]={title:d.attr("data-title"),type:d.attr("data-type"),description:d.attr("data-desc")})}},clearLocalStorage:function(){store["delete"]("bilibili_helper_quiz_bet",b.roomId),store["delete"]("bilibili_helper_quiz_check",b.roomId),store["delete"]("bilibili_helper_quiz_number",b.roomId),store["delete"]("bilibili_helper_quiz_rate",b.roomId),store["delete"]("bilibili_helper_quiz_which",b.roomId),store["delete"]("bilibili_helper_doSign"),store["delete"]("bilibili_helper_userInfo")},localStorage:function(){b.init.clearLocalStorage(),store.has("bilibili_helper_init")?b.hasInit=!0:store.set("bilibili_helper_init",!0),store.has("bilibili_helper_live_roomId")||store.set("bilibili_helper_live_roomId",{}),!store.has("bilibili_helper_doSign")&&store.set("bilibili_helper_doSign",{}),!store.has("bilibili_helper_userInfo")&&store.set("bilibili_helper_userInfo",{}),!store.has("bilibili_helper_treasure_silver_count")&&store.set("bilibili_helper_treasure_silver_count",0),!store.has("bilibili_helper_chat_display")&&store.set("bilibili_helper_chat_display",{}),!store.has("bilibili_helper_tvs_count")&&store.set("bilibili_helper_tvs_count",0),!store.has("bilibili_helper_tvs_reward")&&store.set("bilibili_helper_tvs_reward",{}),!store.has("bilibili_helper_lottery_count")&&store.set("bilibili_helper_lottery_count",0),!store.has("bilibili_helper_lottery_reward")&&store.set("bilibili_helper_lottery_reward",{}),!store.has("bilibili_helper_lottery_reward_list")&&store.set("bilibili_helper_lottery_reward_list",{}),!store.has("bilibili_helper_beat_roomList")&&store.set("bilibili_helper_beat_roomList",[])},userInfo:function(a){return b.getUserInfoInRoom().done(function(c){if(0===c.code){var d=c.data;store.set("bilibili_helper_userInfo",d),b.user=d,store.set("bilibili_helper_login",!0),a&&"function"==typeof a&&a(d)}else c.code===-101&&store.remove("bilibili_helper_userInfo")})}},b.init["do"]()}}();